{% block stylesheets %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
<link rel="stylesheet" href="{{ asset('css/building_manager.css') }}" />
{% endblock %}

{% block Body %}
<div class="container" style="margin-top: 45px;">

    {% block navbar %}
    {% include "./partials/_navbar.html.twig" %}
    {% endblock navbar %}
</div>
<div class="container">
    <h1>Planning des quais</h1>

    {% set buildingNames = [] %}
    {% for buildingName, events in rdvsByBuilding %}
    {% set buildingNames = buildingNames|merge([buildingName]) %}
    {% endfor %}

    <div class="filters">
        <form action="{{ path('app_building_manager') }}" method="GET">
            <label for="date">Filtre par date :</label>
            <input type="date" name="date" id="date" value="{{ app.request.query.get('date', now|date('Y-m-d')) }}" />
            <button class="btn btn-success" type="submit">Filtrer</button>
        </form>
    </div>

    <table>
        <thead>
            <tr>
                <th>Time</th>
                {% for buildingName in buildingNames|sort %}
                <th>{{ buildingName }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
        {% for i in range(8, 17) %}
        <tr>
            <td>{{ i }}h00-{{ i+1 }}h00</td>
            {% for buildingName in buildingNames|sort %}
                {% set events = rdvsByBuilding[buildingName]|filter(event => event.start|date('Y-m-d') ==
                app.request.query.get('date')) %}
                {% set eventFound = false %}
                {% for event in events %}
                    {% set eventStartHour = event.start|date('H') %}
                    {% set eventEndHour = event.end|date('H') %}
                    {% if eventStartHour <= i and eventEndHour > i %}
                        {% set nbEmplacement = eventEndHour - eventStartHour %}
                        <td onclick="window.location.href='/calendar/{{ event.id }}/edit';" style="cursor: pointer;">
                            {{ event.title }} Nbre de palettes : {{ event.palletsNumber }} Client : {{ event.customer }} transporteur : {{ event.transporter }}
                        </td>
                        {% set eventFound = true %}
                    {% endif %}
                {% endfor %}
                {% if not eventFound %}
                    <td onclick="window.location.href='/calendar/new';" style="cursor: pointer;"></td>
                {% endif %}
            {% endfor %}
        </tr>
        
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}